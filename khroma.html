<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>George Hastings</title>
		<link rel="stylesheet" href="css/main.css" media="screen">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes" />
	</head>
	<body class="khroma-colors">
		<div id="app" class="wrapper">
			<header><a href="index.html">George Hastings</a></header>
			<div class="neat-thing" id="move_text"><div class="nt-inner">The AI color tool for designers</div></div>
			<!-- <img class="project-hero" src="assets/images/khroma_thumb.png"> -->
			<video class="project-hero" autoplay loop>
				<source src="assets/video/demo.mp4" type="video/mp4">
				<img src="assets/images/khroma_thumb.png" title="Your browser does not support the <video> tag">
			</video>
			<section class="intro">
				<h3>Khroma</h3>
				<p>I designed and built a product to be <span class="code">the fastest way to discover, search, and save color combos</span> personalized for you.</p>
				<div class="project-link buzzword" data-buzzword="Live">
					<a class="faux-link" href="http://www.khroma.co">Visit the site</a>
				</div>
			</section>
			<section class="content">
				<p class="subline">TL;DR: Why painstakingly craft color pallettes ourselves when we could train an AI to be an extention of our personal tastes as designers? I built Khroma so we can try.</p>
				<h4>Background</h4>
				<p>Early summer of 2016, after months of dabbling and skimming, I decided that I was really going to try to "get into" machine learning. Despite having no experience in computer science and lackuster high school math grades, I couldn't help but find ML facinating. Not long after poking around, I came across <a class="faux-link" href="https://github.com/cazala/synaptic">synaptic.js</a>. It's a neural network library written in javascript for node and the browser  - something I could wrap my head around. After reading the docs and fiddling a little bit, I had it ready to go - all i needed was something to do with it.</p>
				<pre>
<span class="comment">// This is how a neural network sees data in synaptic</span>
const trainingData = [{
  input: [0,0,1,0.12,0,0,0,0,1,1],
  output: [1]
}]</pre>
				<p>I decided to train basic sigmoid model (outputs a probability between 0 and 1) &mdash; basically hotdog/not hotdog. Looking at how synaptic's model accepted training data, I first thought of rgb color values. At the time I was making a lot of demos in <a class="faux-link" href="https://codepen.io/georgehastings/">codepen.io</a> and trying to make landing pages for some JS libs Iâ€™d written. I was struggling to find good color palettes to use. Could I train a neural network to predict whether or not I like a color?</p>
				<pre>
<span class="comment">// Turn rgb(113, 48, 219) into an array [113, 48, 219]</span>
<span class="comment">// Divide by 255 since we need to normalize rgb values between 0 and 1</span>
<span class="comment">// Output 1 since I like this color</span>
const trainingData = [{
  input: [0.44,0.19,0.86],
  output: [1]
}]</pre>
				<p>I made a quick voting app that displayed a color full-screen to which a user could vote yes or no. I voted hundreds, maybe thousands of times and had colleagues do it too. I ran the data through a neural net and had it produce blocks of colors. The results were mostly good but inconsistent &mdash; and the colors had no relation to one another. Mostly the voting was a pain in the ass (I'd realize later I was doing this all wrong). Excited by some success, I quickly moved on to more complex challenges like predicting bitcoin prices (fail), achieving perfect standard play blackjack (pass), next character generation (fail), <span data-tippet="<img src='assets/images/selfportrait.png'> Tried to get an LSTM to render my portrait">generating images (?)</span>, and more. I spent a lot of time being frustrated by limited knowledge, limited laptop compute power, and the limitations of the library.</p>
				<p>Then I saw <a class="faux-link" href="http://www.vanschneider.com/colors/">Color Claim</a> by Tobias Van Schneider.</p>
				<div class="media">
					<div clas="media-wrap">
						<img src="assets/images/colorclaim.png">
					</div>
					<div class="media-caption">102 nice handmade color combinations. I've been convinced that desipite conventional opinion, you shouldn't need more than 2 colors for the majority of web design (not including success/warning etc).</div>
				</div>
				<p>The concept is Tobias, a well known designer, was asked about his color workflow often enough that he created a public collection of palettes he'd created and saved over the years. I loved how the colors had context with typography. It felt useful. This got me to take a second look at the color net.</p>
				<h3 class="block-quote">Why painstakingly craft color pallettes ourselves when we could train an AI to be an extention of our personal tastes as designers?</h3>
				<p>If the machine knows what I like, why not make it do the hard work? That's when I started building Khroma.</p>
			</section>
			<section class="content">
				<h4>So what's the "AI"?</h4>
				<p>Getting the results I wanted took countless hours of experimenting, researching, tweaking, and simply waiting. I tried training the model with every color space I could (rgb, hsv, hsl, lab, yuv). Then there was was question of how much and what kind of data to use. Do people need to vote yes and no? There are around 16M rgb colors - do I need 100, 500, 1000 votes? After months of trial and error, I found a satisfactory solution. By choosing 50 well balanced colors (likes only), Khroma uses the deltaE color distance algorithm to extrapolate 9000 dislikes and likes at a 5:1 ratio, which then trains a local feed-forward neural network. Training in the browser typically takes a little over 2 minutes with a training accuracy between 96-99%. Not too bad.</p>
				<p>We now have an algorithm that, when given a random color, can tell whether or not you'll like it with 96-99% accuracy. When I tested it with people, they often asked "how are they paired together?" The answer was "randomly", which didn't feel like a strong response.</p>
				<p>Let me just note here that I wanted to steer away from color theory, as I don't think our perception and the theory always align. Ever seen a beautiful <span data-tippet="<img src='assets/images/rggrad.png'> Woof">red/green gradient</span>?</p>
				<p>Khroma has two other ML algorithms, one for matching two colors together and another for matching four together (people wanted the option to see more than two colors, I agreed). They're both trained from a sample of 2000+ popular color palettes I managed to pull from myriad sources. They're distinct because the two color one needed a minimum constrast restriction.</p>
				<div class="media">
					<div class="media-wrap">
						<img src="assets/images/palettes.png">
					</div>
					<div class="media-caption">Before figuring out how to construct the model, I took some time to try and understand what was going on under the hood of great looking palettes. For example, I took this first palette and swapped out its lightness values for those from a different palette. Although they shared the same hue and saturation, the result was terrible. I tried the same but swapped out the hue, the results were much better. Observations like these helped inform my model/data construction.</div>
				</div>
				<p>Luckily I quickly found success in implementing these improvements. By first generating colors you like with the network trained by you, they are matched with the algorithms trained by ideal examples. </p>
			</section>
			<section class="content">
				<h4>Some thoughts on the user experience</h4>
				<p>A lot of palette generator sites feature a single palette with a refresh button or a hover and click to set interaction. You either get it right, refresh single colors, or tweak parameters. This to me has always felt too "lean in". I wanted something more about discovery, more like digging for gold. There are also pleny of sites with premade palettes too, but I like others I hope, want to stumble accross something ostensibly original.</p>
				<p>I decided to go with an infinite scroll UI to feel more like browsing Pinterest than laborously tweaking range sliders.</p>
				<div class="media">
					<div class="media-wrap">
						<video autoplay loop>
						  <source src="assets/video/khroma_scroll.mp4" type="video/mp4">
							<img src="assets/images/khroma_thumb.png" title="Your browser does not support the <video> tag">
						</video>
					</div>
					<div class="media-caption">I did some front-end wizardry to keep the page light and fast. The rendering code recycles the DOM elements rather than junking up the page and memory.</div>
				</div>
				<p>With that in place I starting playing around with use cases. How do people want to see their colors? What do they want to know about them? Luckily this was a case of designing for myself, so after a lot of playing around I eventually settled typeography, swatch, gradient, image, and palette. Each pair has its respective names, hex and rgb values, and WCAG accessibility rating.</p>
				<p>Communicating the effect of the AI was a challenge since the neural network produces colors using probability.</p>
				<pre>myNeuralNet.activate(randomColor);
<span class="comment">// 0.7912443</span></pre>
				<p>The net thinks there's a 79% chance I'll like <span class="code">randomColor</span>. Is that good enough? If it's set to nothing less than 99.99% then there won't be much variation outside of the original training set. If it allows colors in the 1-10% range then it would likely produce some I don't like, but i'll see a lot more variation. So while not perfect, I added an adjustable bias per color &mdash; I think it's important to let the user control the strictness of the generator. I like to have mine around 70%.</p>
			</section>
			<section class="content">
				<h4>Going forward</h4>
				<p>While there's much more to say about it, I'm mostly looking forward to getting feedback from those interested in seeing Khroma continue to evolve. If you're still reading this then you should probably give it a try if you haven't already. I love to hear how Khroma works for you!</p>
				<div class="project-link buzzword" data-buzzword="Enjoy!">
					<a class="faux-link" href="http://www.khroma.co">Visit the site</a>
				</div>
			</section>
			<footer>
				<div class="copyright">Â© <span id="copyright"></span> <a href="index.html">George Hastings</a></div>
				<div class="courtesy">
					<div class="email faux-link">Email me</div>
					<a class="faux-link" href="http://www.codepen.io/georgehastings">Codepen</a>
					<a class="faux-link" href="http://www.github.com/georgehastings">Github</a>
					<a class="faux-link" href="https://www.linkedin.com/in/george-hastings-a6874514/">LinkedIn</a>
				</div>
			</footer>
		</div>
		<div class="toaster"></div>
		<script src="/scripts/magnetic.js"></script>
		<script src="/scripts/pizazz.js"></script>
		<script src="/scripts/tippet.js"></script>
		<script src="/scripts/app.js"></script>
		<script>
			tippet.init({background: '#7130db', text: '#fff'});
		</script>
	</body>
</html>
